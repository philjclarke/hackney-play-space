!function(h){h(document).on("click",'[data-trigger="um-user-photos-modal"]',function(t){t.preventDefault();var a=h("body").find('[data-scope="um-user-photos-modal"]'),e=h(this).attr("data-modal_title"),s=a.find(".um-user-photos-modal-content");s.html('<div class="text-center"><div class="um-user-photos-ajax-loading"></div></div>'),a.show();var o=h(this).attr("data-template"),r={template:o};if("edit"==h(this).attr("data-scope")){var n=h(this).attr("data-id");"album"==h(this).attr("data-edit")&&(r={template:o,album_id:n}),"image"==h(this).attr("data-edit")&&(r={template:o,image_id:n,album_id:h(this).attr("data-album")})}h.post(h(this).attr("data-action"),r,function(t){s.html(t),h("#um-user-photos-sortable").sortable()}),a.find(".um-user-photos-modal-title").text(e)}),h(document).on("click",".um-user-photos-modal-close-link",function(t){t.preventDefault(),h(this).parents(".um-user-photos-modal").hide(),h(this).parents(".um-user-photos-modal").find(".um-user-photos-modal-title").text(""),h(this).parents(".um-user-photos-modal").find(".um-user-photos-modal-content").html("")}),h(document).on("click",".um-galley-modal-update",function(t){t.preventDefault();var s=h(this),o=s.text(),a=s.parents("form"),e=a.attr("data-limit"),r=a.attr("data-count"),n=h("#um-user-photos-images-uploaded img").length;if(""!==e&&parseInt(n)+parseInt(r)>parseInt(e))h(".um-user-photos-error").show();else{h(".um-user-photos-error").hide();var i=a.attr("action"),l=a[0],u=new FormData(l);s.html('<i class="um-user-photos-ajax-loading"></i>'),s.attr("disabled",!0);var d=a.find(".um-galley-form-response");d.removeClass("success").removeClass("error"),d.html(""),h.ajax({type:"POST",url:i,data:u,cache:!1,contentType:!1,processData:!1,success:function(a){if("success"==a)location.reload();else{s.html(o),s.removeAttr("disabled");try{json=JSON.parse(a),d.addClass(json.type);var e="<ul>";h.each(json.messages,function(t,a){e+="<li>"+a+"</li>"}),e+="</ul>",d.html(e)}catch(t){console.log(a),a.statusText&&d.html("<span>Error:"+a.statusText+"</span>").addClass("error")}}},error:function(t){s.html(o),s.attr("disabled",!1),console.log("error"),console.log(t),t.statusText&&d.html("<span>Error:"+t.statusText+"</span>").addClass("error")}})}}),h(document).on("click",".um-user-photos-album-block",function(t){t.preventDefault();var a=h(this).parents(".um-user-photos-albums");a.html('<div class="text-center"><div class="um-user-photos-ajax-loading"></div></div>');var e=h(this).attr("data-id"),s=h(this).attr("data-action");h.post(s,{id:e},function(t){a.replaceWith(t)}),a.siblings(".um-user-photos-add").remove()}),h(document).on("click",".back-to-um-user-photos",function(t){t.preventDefault();var a=h(this).parents(".um-user-photos-albums"),e=h(this).attr("data-profile");a.html('<div class="text-center"><div class="um-user-photos-ajax-loading"></div></div>'),h.post(h(this).attr("data-action"),{template:h(this).attr("data-template"),user_id:e},function(t){a.replaceWith(t)})}),h(document).on("click",".um-user-photos-view-toggle",function(t){if(t.preventDefault(),!h(this).hasClass("active")){var a=h(this).parents(".um-profile-body.photos"),e=h(this).attr("data-profile");a.html(""),a.html('<div class="text-center"><div class="um-user-photos-ajax-loading"></div></div>'),h.post(h(this).attr("data-action"),{template:h(this).attr("data-template"),user_id:e},function(t){a.html(t)})}}),h(document).on("click","#delete-um-album",function(t){t.preventDefault();var s=h(this),a=s.parents("form"),o=s.text(),e=s.attr("data-action"),r=s.attr("data-id"),n=s.attr("data-wpnonce");h(this).parents(".um-profile-body.photos");s.html('<i class="um-user-photos-ajax-loading"></i>'),s.attr("disabled",!0);var i=a.find(".um-galley-form-response");i.removeClass("success").removeClass("error"),i.html(""),h.post(e,{id:r,_wpnonce:n},function(a){if("success"==a)location.reload();else{s.html(o),s.attr("disabled",!1);try{json=JSON.parse(a),i.addClass(json.type);var e="<ul>";h.each(json.messages,function(t,a){e+="<li>"+a+"</li>"}),e+="</ul>",i.html(e)}catch(t){console.log(a),a.statusText&&i.html("<span>Error:"+a.statusText+"</span>").addClass("error")}}})}),h(document).on("click","#um-user-photos-image-update-btn",function(t){t.preventDefault();var s=h(this),o=s.text(),a=s.parents("form"),e=a.attr("action");h(this).parents(".um-profile-body.photos");s.html('<i class="um-user-photos-ajax-loading"></i>'),s.attr("disabled",!0);var r=a.find(".um-galley-form-response");r.removeClass("success").removeClass("error"),r.html(""),h.post(e,a.serialize(),function(a){s.html(o),s.attr("disabled",!1);try{json=JSON.parse(a),r.addClass(json.type);var e="<ul>";h.each(json.messages,function(t,a){e+="<li>"+a+"</li>"}),e+="</ul>",r.html(e),"success"===json.type&&setTimeout(function(){r.parents(".um-user-photos-modal").hide()},2e3)}catch(t){console.log(a),a.statusText&&r.html("<span>Error:"+a.statusText+"</span>").addClass("error")}})}),h(document).on("click","[data-delete_photo]",function(t){t.preventDefault(),h(this).hide();var a=h(this).attr("data-confirmation"),s=h(this).attr("data-delete_photo"),e=h(this).attr("data-id"),o=h(this).attr("data-wpnonce"),r=h(this).attr("href"),n=h(this).attr("data-album"),i=h("#um-user-photos-form-edit-album").attr("data-limit"),l=h("#um-user-photos-form-edit-album").attr("data-count");confirm(a)?h.post(r,{image_id:e,album_id:n,_wpnonce:o},function(t){if("success"==t){if(h(s).remove(),""!==i){var a=l-1,e=h("#um-user-photos-images-uploaded img").length;h("#um-user-photos-form-edit-album").attr("data-count",a),parseInt(e)+parseInt(a)<parseInt(i)&&(h("#um-user-photos-form-edit-album .um-modal-btn").show(),h("#um-user-photos-form-edit-album .um-user-photos-error").hide(),h("#um-user-photos-input-album-images, .um-galley-modal-update").removeAttr("disabled"))}}else console.log(t),t.statusText&&response_div.html("<span>Error:"+t.statusText+"</span>").addClass("error")}):h(this).show()}),h(document).on("click","#um-user-photos-toggle-view-photos-load-more",function(t){t.preventDefault();var e=h(this),s=e.parents(".um-load-more"),o=e.text(),a=e.attr("data-href"),r=e.attr("data-profile"),n=e.attr("data-per_page"),i=e.attr("data-current_page"),l=e.parents(".um-user-photos-albums"),u=l.find(".photos-container");e.attr("data-current_page",parseInt(i)+1),e.text("Loading"),e.attr("disabled",!0),l.css("opacity","0.5"),h.post(a,{profile:r,per_page:n,page:i},function(t){var a=(t.match(/data-umaction/g)||[]).length;e.text(o),e.attr("disabled",!1),l.css("opacity","1"),"empty"==t?s.remove():(u.append(t),a<parseInt(n)&&s.remove())})}),h(document).on("change","#um-user-photos-input-album-cover",function(t){var e=h(this).parents("h1.album-poster-holder"),a=new FileReader;a.onload=function(t){var a=t.target.result;e.css("background-image",'url("'+a+'")'),e.css("background-size","contain")},a.readAsDataURL(this.files[0])}),h(document).on("change","#um-user-photos-input-album-images",function(t){var a=h(this).parents("form"),e=h(this).parents("form").find("#um-user-photos-images-uploaded"),s=t.target.files;e.html("");for(var o=0;o<s.length;o++){var r=s[o];if(r.type.match("image")){var n=new FileReader;n.addEventListener("load",function(t){var a=t.target;e.append('<img style="display:inline;height:70px;margin:2px;border:1px solid #000;" src="'+a.result+'" data-index=""/>')}),n.readAsDataURL(r)}}var i=a.attr("data-count"),l=a.attr("data-limit");""!==l&&(o+parseInt(i)>parseInt(l)?(h(".um-user-photos-error").show(),h(".um-galley-modal-update").attr("disabled","disabled")):(h(".um-user-photos-error").hide(),h(".um-galley-modal-update").removeAttr("disabled")))}),h(document).on("click","#um_user_photos_delete_all",function(t){t.preventDefault();var a=h(this);if(!a.hasClass("inactive")){var e=a.attr("data-alert_message"),s=a.attr("data-profile"),o=a.attr("data-wpnonce"),r=a.attr("href");confirm(e)&&(a.addClass("inactive"),a.text("Processing...Please wait."),h.post(r,{profile_id:s,_wpnonce:o},function(t){"object"==typeof t&&t.success?(a.parent("p").append('<font style="color:green;display:block;text-align:center;">Deleted Successfully !</font>'),a.remove()):console.log(t)},"json"))}}),h(document).on("change","#um-user-photos-input-album-cover",function(t){t.preventDefault();var a=h(this),e=a.parents("form"),s=e.attr("data-max_size"),o=e.attr("data-max_size_error"),r=e.find(".um-user-photos-modal-footer"),n=e.find(".um-galley-form-response");n.html("").removeClass("error"),r.show();var i=s/1e6;if(a[0].files&&s<=a[0].files[0].size){var l=a[0].files[0].name+" "+o+" "+i+" MB";return a.trigger("reset"),n.html("<span>"+l+"</span>").addClass("error"),r.hide(),!1}}),h(document).on("change","#um-user-photos-input-album-images",function(t){t.preventDefault();var a=h(this),e=a.parents("form"),s=e.attr("data-max_size"),o=e.attr("data-max_size_error"),r=e.find(".um-user-photos-modal-footer"),n=e.find(".um-galley-form-response");n.html("").removeClass("error"),r.show();var i=s/1e6;if(a[0].files){for(var l=!1,u=0,d="",m=a[0].files,p="",c=0;m[c];c++)u=a[0].files[c].size,d=a[0].files[c].name,s<=u&&(l=!0,'<p style="margin:0;">'+(p=d+" "+o+" "+i+" MB")+"</p>");if(l)return n.html("<span>"+p+"</span>").addClass("error"),r.hide(),!1}}),h(document).on("click",".um-user-photos-album-options",function(t){t.preventDefault();var a=h(this).next(".um-dropdown");return a.length&&UM.dropdown.show(a)}),h(document).on("click",".um-dropdown-hide",function(t){t.preventDefault(),UM.dropdown.hideAll()}),h(document).on("click","[data-um-pagi-action] [data-page]",function(t){t.preventDefault();var a=jQuery(t.currentTarget).closest("[data-um-pagi-action]"),e=a.data("um-pagi-action");wp.ajax.post(e,{data:a.data(),page:jQuery(t.currentTarget).data("page"),per_page:a.data("um-pagi-per_page")}).done(function(t){a.html(jQuery(t).unwrap()),h(document).trigger("resize")})})}(jQuery);